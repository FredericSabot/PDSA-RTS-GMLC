The dispatches generated by Prescient in the previous step are generated using a DC N-1 market model. In this step, a Preventive Security-Constrained AC Optimal Power Flow (PSCACOPF.py) is performed to generate AC N-1 secure dispatches and to convert them in Dynawo/Powsybl format.

PSCACOPF are difficult to solve numerically, especially if they are not initialized in a good way. The PSCACOPF.py script thus solves a series of increasingly complex problems to solve the full PSCACOPF. Each problem is initialised based on the solution of the previous one

1. a-PSCDCOPF/PSCDCOPF.gms: a DC PSC-OPF (accounting for an estimation of the losses), to find an estimation of the active power dispatch
2. b-ACOPF/ACOPF.gms: an AC OPF (without N-1 constraints) aiming at finding a feasible AC solution to the power flow equations the closest possible to the solution of the DC PSC-OPF and trying to set the reactive power of generators close to the middle of their capability. The aim is to avoid to push voltages to their upper bound to reduce the losses by generating the maximum of reactive power, at the expense of security (no margin).
3. c-PSCACOPF/PSCACOPF.gms: an AC SCOPF that considers N-1 constraints. For performance and stability, only contingencies that are not secure in the current dispatch are iteratively added to the optimisation problem.

The final dispatches are written in d-Final-dispatch in Powsybl/Dynawo format (with name = $hour_of_year.iidm) and used in the next step.

The postprocessing/ folder contains small scripts for manual inspection of the results. They are not part of the main workflow.


# Requirements

## OPF

Pypowsybl
```
python -m pip install pypowsybl
```

[GAMS](https://www.gams.com/download/) and GAMS Python bindings. Note that depending on the GAMS version, different installation procedures are suggested for the python bindings, e.g. [link](https://www.gams.com/36/docs/API_PY_TUTORIAL.html) or [link](https://www.gams.com/43/docs/API_PY_GETTING_STARTED.html).

Tested with Python 3.9 and GAMS 36. Note that older versions of GAMS might not support recent versions of Python and that Pypowsybl requires Python >= 3.7


# Usage

## OPF

```
cd 2-SCOPF
./run.sh
```
Note that a SLURM-based runner (run_cluster.sh) is also available for use in high-performing computing. Each dispatch runs in a few dozens of seconds if the system is already N-1 secure after the ACOPF or several minutes if the PSCACOPF has to be run. A 10-minute timeout is included in the SLURM runner.
